<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  
  
  

  
  <title>Istina&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="C 题目大意： 给定一个由小写字母构成的字符串和若干次修改操作。在每次修改后，求其符合以下要求的最大子串长度：出现奇数次的字母有奇数个，出现非零偶数次的字母有偶数个。 难度： ~2000 知识点： 线段树，分类讨论 观察可以得到，要求等价于：串长和字符集大小都为奇数。这一点可以通过枚举串长和字符集大小各自的奇偶性来验证。 然后进行分类讨论。  当字符集大小为奇数时：  如果串长为奇">
<meta property="og:type" content="article">
<meta property="og:title" content="Istina&#39;s Blog">
<meta property="og:url" content="https://zja2524926597.github.io/2025/07/24/%E6%9A%91%E8%AE%AD#3%E8%A1%A5%E9%A2%98/index.html">
<meta property="og:site_name" content="Istina&#39;s Blog">
<meta property="og:description" content="C 题目大意： 给定一个由小写字母构成的字符串和若干次修改操作。在每次修改后，求其符合以下要求的最大子串长度：出现奇数次的字母有奇数个，出现非零偶数次的字母有偶数个。 难度： ~2000 知识点： 线段树，分类讨论 观察可以得到，要求等价于：串长和字符集大小都为奇数。这一点可以通过枚举串长和字符集大小各自的奇偶性来验证。 然后进行分类讨论。  当字符集大小为奇数时：  如果串长为奇">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-07-24T13:23:55.785Z">
<meta property="article:modified_time" content="2025-07-26T09:57:34.020Z">
<meta property="article:author" content="Ethan Zhou">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Istina's Blog" type="application/atom+xml">
  
  
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-192.png" sizes="192x192">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-192.png" sizes="192x192">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/images/banner.jpg" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="  ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>Istina's Blog </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/categories">Categories</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
      <a id="nav-rss-link" class="nav-icon mobile-hide" href="/atom.xml" title="RSS 订阅">
        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M198-120q-25.846 0-44.23-18.384-18.384-18.385-18.384-44.23 0-25.846 18.384-44.23 18.384-18.385 44.23-18.385 25.846 0 44.23 18.385 18.384 18.384 18.384 44.23 0 25.845-18.384 44.23Q223.846-120 198-120Zm538.385 0q-18.846 0-32.923-13.769-14.076-13.769-15.922-33.23-8.692-100.616-51.077-188.654-42.385-88.039-109.885-155.539-67.5-67.501-155.539-109.885Q283-663.462 182.385-672.154q-19.461-1.846-33.23-16.23-13.769-14.385-13.769-33.846t14.076-32.922q14.077-13.461 32.923-12.23 120.076 8.692 226.038 58.768 105.961 50.077 185.73 129.846 79.769 79.769 129.846 185.731 50.077 105.961 58.769 226.038 1.231 18.846-12.538 32.922Q756.461-120 736.385-120Zm-252 0q-18.231 0-32.423-13.461t-18.653-33.538Q418.155-264.23 348.886-333.5q-69.27-69.27-166.501-84.423-20.077-4.462-33.538-18.961-13.461-14.5-13.461-33.346 0-19.076 13.884-33.23 13.884-14.153 33.115-10.922 136.769 15.384 234.384 112.999 97.615 97.615 112.999 234.384 3.231 19.23-10.538 33.115Q505.461-120 484.385-120Z"/></svg>
      </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/categories">Categories</a>
    
    
      <a class="nav-dropdown-link" href="/atom.xml" title="RSS 订阅">RSS</a>
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/images/avatar.jpg></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">Istina </div>
      <div class="dot"></div>
      <div class="subtitle">Everything Matters. </div>
      <div class="link-list">
        
          <a class="link-btn" href="https://codeforces.com/profile/_istina_" title="Codeforces" target="_blank" rel="noopener">
            
              <img
                src="/images/codeforces-light.png"
                data-light="/images/codeforces-light.png"
                data-dark="/images/codeforces-dark.png"
                alt="Codeforces"
                class="social-img-icon theme-sensitive-icon"
              >
            
          </a>
        
          <a class="link-btn" href="https://steamcommunity.com/profiles/76561199492628847/" title="Steam" target="_blank" rel="noopener">
            
              <i class="fa-brands fa-steam"></i>
            
          </a>
        
          <a class="link-btn" href="https://github.com/zja2524926597" title="GitHub" target="_blank" rel="noopener">
            
              <i class="fa-brands fa-github"></i>
            
          </a>
         
      </div>        
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">分类</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
                学习笔记
                <div class="category-count">1</div>
            </a>
        
            <a class="category-link" href="/categories/%E6%B8%B8%E6%88%8F%E8%AE%B0%E5%BD%95/">
                游戏记录
                <div class="category-count">1</div>
            </a>
        
            <a class="category-link" href="/categories/%E9%A2%98%E8%A7%A3/">
                题解
                <div class="category-count">5</div>
            </a>
        </div>
    </div>
  </div>


    
      

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       


<article id="post-暑训#3补题" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        无标题
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2025-07-24T13:23:55.785Z" itemprop="datePublished">2025-07-24</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
    未分类 
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            5.6k 词 
          </div>
          <div class="need-seperator meta-info">
            <span id="busuanzi_container_page_pv" class="post-meta-item busuanzi-inline">
              <i class="fas fa-eye"></i> <span id="busuanzi_value_page_pv"></span>
            </span>
          </div>          
        </div>
        
      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <h1 id="c">C</h1>
<p><strong>题目大意：</strong> 给定一个由小写字母构成的字符串和若干次修改操作。在每次修改后，求其符合以下要求的最大子串长度：出现奇数次的字母有奇数个，出现非零偶数次的字母有偶数个。</p>
<p><strong>难度：</strong> ~2000 <strong>知识点：</strong> 线段树，分类讨论</p>
<p>观察可以得到，要求等价于：串长和字符集大小都为奇数。这一点可以通过枚举串长和字符集大小各自的奇偶性来验证。</p>
<p>然后进行分类讨论。</p>
<ul>
<li><p>当字符集大小为奇数时：</p>
<ul>
<li><p>如果串长为奇数：直接取原串即可。</p></li>
<li><p>如果串长为偶数：</p>
<ul>
<li><p>如果首或尾字母出现了超过一次，那么删去它不改变字符集大小，但让串长变为奇数，符合了要求。</p></li>
<li><p>如果首尾字母都只出现了一次，我们正序和倒序分别找到第一个出现多次的字母。为了方便下文叙述，我们不妨设原串形如 <code>[abcd X ... Y uvw]</code>，其中小/大写字母分别代表出现一/多次的字母。</p>
<p>那么如果我们只删去头尾的若干字母，字符集大小和串长的奇偶性一定同时改变，不可能同时变为奇数。因此，我们至少需要删到串中的 <code>X</code> 或 <code>Y</code> 。</p>
<ul>
<li>如果删去的串长为奇数（如 <code>[abcdX]</code>），则剩下的串长和字符集大小都为奇数，符合了要求。</li>
<li>如果删去的串长为偶数（如 <code>[Yuvw]</code>），则剩下的串长和字符集大小都为偶数，我们再删去另一端的一个字母即可符合要求。</li>
</ul>
<p>分别求解删除两端的情形后，对答案取较大值即可。</p></li>
</ul></li>
</ul></li>
<li><p>当字符集大小为偶数时：</p>
<p>我们可以这样做：对于每种字符，求不含它的极大子串。可以证明，所有极长子串中最长的一个的字符集大小一定就是原串字符集大小减一，是一个奇数。</p>
<p>证明很显然。记原串形如 <code>...A[...]A..</code> ，<code>[...]</code> 是最大极长子串，不包含的字母是 <code>A</code>。</p>
<p>使用反证法，假设该子串字符集大小不为原串字符集大小减一，说明一定存在某不为 <code>A</code> 的字母不在该子串中，记为 <code>B</code>。无论原串的形式为 <code>..B...A[...]A..</code> 还是 <code>..B..A[...]A..B..</code> ，不含 <code>B</code> 的极大子串一定比不含 <code>A</code> 的极大子串更长，这与 <code>[...]</code> 是最大极长子串相矛盾。因此假设不成立，证明完成。</p>
<p>由于至少需要删去一种字符，最终的答案一定不长于最大极长子串，此处设该最大极长子串长度为 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.541ex" height="1.545ex" role="img" focusable="false" viewBox="0 -683 681 683"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D43F" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path></g></g></g></svg></mjx-container></span>。</p>
<ul>
<li><p>如果最大极长子串串长为奇数，直接取，答案就是 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.541ex" height="1.545ex" role="img" focusable="false" viewBox="0 -683 681 683"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D43F" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path></g></g></g></svg></mjx-container></span>。</p></li>
<li><p>如果最大极长子串串长为偶数，与第一类讨论类似地：</p>
<ul>
<li><p>如果子串首或尾字母在串内出现了超过一次，那么删去它不改变字符集大小，但让串长变为奇数，符合了要求。答案是 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="5.438ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 2403.4 765"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D43F" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path></g><g data-mml-node="mo" transform="translate(903.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(1903.4,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></svg></mjx-container></span>。</p></li>
<li><p>如果首尾字母都只出现了一次，记原串形如 <code>...A [abc X ... Y uvw] A...</code>，其中小/大写字母分别代表在子串内出现一/多次的字母，<code>[]</code> 内为最大极长子串。</p>
<p>观察后可知，<code>A</code> 右侧为 <code>a</code> 或右边界。否则 <code>a</code> 分割成的子串将长于最大极长子串。该性质可以向左右推广，也就是说原串一定是 <code>...uvw A [abc X ... Y uvw] A abc...</code> 的子串。</p>
<p>我们考虑 <code>...A(abc X ... Y uvw A)...</code> 括号内的串，初始字符集大小为偶数，串长为奇数。</p>
<p>试着往右侧移动括号范围。括号内最左侧仍为单次出现的字母时，括号内子串奇偶性质保持不变。</p>
<p>当最左侧为多次出现字母时（如 <code>...A abc (X ... Y uvw A abc)...</code> 所示）我们直接删去最左侧的 <code>X</code> 和最右侧的 <code>c</code>，剩下的串长和字符集大小都为奇数。这个奇数是不大于最大极长子串长度的最大奇数，是最优值。向左侧移动同理。只要有一侧能移到，答案就是 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="5.438ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 2403.4 765"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D43F" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path></g><g data-mml-node="mo" transform="translate(903.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(1903.4,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></svg></mjx-container></span>。这个过程中移动不超过 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1000 688"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container></span> 次。</p>
<p>移不到的情况形如 <code>vw A ab(c X ... Y uvw A ab)</code>，子串两侧的部分长度很短。</p>
<p>由于初始时 <code>()</code> 内字符集大小为偶数，串长为奇数。而删单次出现字符会使字符集大小和串长的奇偶性同时改变，不能使两者同时变为奇数。必须删多次出现的字母。</p>
<p>以上串为例，再删去括号内的 <code>cX</code> 后，剩下部分的字符集大小和串长的奇偶性就相同了。如果是偶数就再删去另一侧的一个单次出现字母即可。求解只需要找到 <code>X</code> 和 <code>Y</code> 的位置，根据其到另一侧的距离计算即可。</p></li>
</ul></li>
</ul>
<p>可以看见，解决问题的关键就是维护当前最大极长子串。</p>
<p>我们开 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="2.262ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 1000 688"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container></span> 个线段树，维护各字母对应的极长子串。将当前字母视为 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.507ex" role="img" focusable="false" viewBox="0 -666 500 666"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></svg></mjx-container></span>，其他字母视为 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g></svg></mjx-container></span>，则问题转化为求最长的连续零段。</p>
<p>线段树内每个节点维护以下信息：【1】区间内最长连续零段的长度；【2】区间内最长连续零段的起始位置【3】从区间最左端起的连续零段的长度；【4】在区间最右端止的连续零段的长度。【5】区间和。</p>
<p>其中维护【5】是为了快速得到某区间内某字母是否多次出现。</p></li>
</ul>
<p>Code：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pii pair<span class="string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FOR(i, a, b) for (int i = a; i &lt;= b; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, q, cnt;</span><br><span class="line"><span class="type">int</span> Ans;</span><br><span class="line">string ss, s;</span><br><span class="line"></span><br><span class="line">map&lt;<span class="type">char</span>, <span class="type">int</span>&gt; mp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">seg_tree</span> {</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">node</span> {</span><br><span class="line">        <span class="type">int</span> mx, lmx, rmx, pos, val;</span><br><span class="line">    } t[N &lt;&lt; <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>{</span><br><span class="line">        t[u].val = t[u &lt;&lt; <span class="number">1</span>].val + t[u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>].val;</span><br><span class="line">        <span class="type">int</span> mmx = t[u &lt;&lt; <span class="number">1</span>].rmx + t[u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>].lmx;</span><br><span class="line">        t[u].mx = <span class="built_in">max</span>(<span class="built_in">max</span>(t[u &lt;&lt; <span class="number">1</span>].mx, t[u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>].mx), mmx);</span><br><span class="line">        t[u].lmx = t[u &lt;&lt; <span class="number">1</span>].lmx;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (t[u &lt;&lt; <span class="number">1</span>].lmx == mid - l + <span class="number">1</span>) t[u].lmx += t[u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>].lmx;</span><br><span class="line">        t[u].rmx = t[u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>].rmx;</span><br><span class="line">        <span class="keyword">if</span> (t[u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>].rmx == r - mid) t[u].rmx += t[u &lt;&lt; <span class="number">1</span>].rmx;</span><br><span class="line">        <span class="keyword">if</span> (t[u].mx == mmx) t[u].pos = mid - t[u &lt;&lt; <span class="number">1</span>].rmx + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (t[u].mx == t[u &lt;&lt; <span class="number">1</span>].mx) t[u].pos = t[u &lt;&lt; <span class="number">1</span>].pos;</span><br><span class="line">        <span class="keyword">else</span> t[u].pos = t[u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>].pos;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (l == r) {</span><br><span class="line">            <span class="keyword">if</span> (id == s[l]) {</span><br><span class="line">                t[u].val = <span class="number">1</span>;</span><br><span class="line">                t[u].mx = t[u].lmx = t[u].rmx = <span class="number">0</span>;</span><br><span class="line">                t[u].pos = <span class="number">0</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                t[u].val = <span class="number">0</span>;</span><br><span class="line">                t[u].mx = t[u].lmx = t[u].rmx = <span class="number">1</span>;</span><br><span class="line">                t[u].pos = l;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="type">int</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">        <span class="built_in">build</span>(u &lt;&lt; <span class="number">1</span>, l, mid);</span><br><span class="line">        <span class="built_in">build</span>(u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, mid + <span class="number">1</span>, r);</span><br><span class="line">        <span class="built_in">pushup</span>(u, l, r);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> x, <span class="type">int</span> op)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (l == r &amp;&amp; l == x) {</span><br><span class="line">            <span class="keyword">if</span> (op) {</span><br><span class="line">                t[u].val = <span class="number">0</span>;</span><br><span class="line">                t[u].mx = t[u].lmx = t[u].rmx = <span class="number">1</span>;</span><br><span class="line">                t[u].pos = l;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                t[u].val = <span class="number">1</span>;</span><br><span class="line">                t[u].mx = t[u].lmx = t[u].rmx = <span class="number">0</span>;</span><br><span class="line">                t[u].pos = <span class="number">0</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="type">int</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (x &lt;= mid) <span class="built_in">modify</span>(u &lt;&lt; <span class="number">1</span>, l, mid, x, op);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">modify</span>(u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, mid + <span class="number">1</span>, r, x, op);</span><br><span class="line">        <span class="built_in">pushup</span>(u, l, r);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> L, <span class="type">int</span> R)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) <span class="keyword">return</span> t[u].val;</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span>, mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (L &lt;= mid) ret += <span class="built_in">query</span>(u &lt;&lt; <span class="number">1</span>, l, mid, L, R);</span><br><span class="line">        <span class="keyword">if</span> (R &gt; mid) ret += <span class="built_in">query</span>(u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, mid + <span class="number">1</span>, r, L, R);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">} tree[<span class="number">26</span>];</span><br><span class="line"></span><br><span class="line"><span class="function">pii <span class="title">fnd</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="type">int</span> mxl = <span class="number">0</span>, mxr = <span class="number">-1</span>;</span><br><span class="line">    <span class="built_in">FOR</span>(i, <span class="number">0</span>, <span class="number">25</span>) {</span><br><span class="line">        <span class="type">int</span> mxi = tree[i].t[<span class="number">1</span>].mx, p = tree[i].t[<span class="number">1</span>].pos;</span><br><span class="line">        <span class="keyword">if</span> (p == <span class="number">1</span> &amp;&amp; p + mxi - <span class="number">1</span> == n) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (mxi &gt; mxr - mxl + <span class="number">1</span>) {</span><br><span class="line">            mxl = p; mxr = p + mxi - <span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">make_pair</span>(mxl, mxr);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (cnt &amp; <span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">if</span> (n &amp; <span class="number">1</span>) {</span><br><span class="line">            <span class="keyword">return</span> n;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">if</span> (mp[s[<span class="number">1</span>]] &gt; <span class="number">1</span> || mp[s[n]] &gt; <span class="number">1</span>) {</span><br><span class="line">                <span class="keyword">return</span> n - <span class="number">1</span>;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="type">int</span> ix = <span class="number">0</span>, iy = <span class="number">0</span>, ans1, ans2;</span><br><span class="line">                <span class="keyword">while</span> (ix + <span class="number">1</span> &lt;= n &amp;&amp; mp[s[ix + <span class="number">1</span>]] == <span class="number">1</span>) ix++;</span><br><span class="line">                <span class="keyword">while</span> (n - iy &gt;= <span class="number">1</span> &amp;&amp; mp[s[n - iy]] == <span class="number">1</span>) iy++;</span><br><span class="line">                <span class="keyword">if</span> (ix &amp; <span class="number">1</span>) ans1 = n - ix - <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">else</span> ans1 = n - ix - <span class="number">1</span>; </span><br><span class="line">                <span class="keyword">if</span> (iy &amp; <span class="number">1</span>) ans2 = n - iy - <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">else</span> ans2 = n - iy - <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">max</span>(ans1, ans2);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        pii tt = <span class="built_in">fnd</span>();</span><br><span class="line">        <span class="type">int</span> len = tt.second - tt.first + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (len &amp; <span class="number">1</span>) <span class="keyword">return</span> len;</span><br><span class="line">        <span class="keyword">else</span> {</span><br><span class="line">            <span class="type">int</span> l = tt.first, r = tt.second;</span><br><span class="line">            <span class="keyword">if</span> (tree[s[l] - <span class="string">'a'</span>].<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, l, r) &gt; <span class="number">1</span>) <span class="keyword">return</span> len - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (tree[s[r] - <span class="string">'a'</span>].<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, l, r) &gt; <span class="number">1</span>) <span class="keyword">return</span> len - <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> cntl = <span class="number">0</span>, cntr = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (l + cntl &lt;= r &amp;&amp; tree[s[l + cntl] - <span class="string">'a'</span>].<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, l, r) == <span class="number">1</span>) cntl++;</span><br><span class="line">            <span class="keyword">while</span> (r - cntr &gt;= l &amp;&amp; tree[s[r - cntr] - <span class="string">'a'</span>].<span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n, l, r) == <span class="number">1</span>) cntr++;</span><br><span class="line">            <span class="keyword">if</span> (l - <span class="number">2</span> &gt;= cntr) <span class="keyword">return</span> len - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (n - r - <span class="number">1</span> &gt;= cntl) <span class="keyword">return</span> len - <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> ans1 = n - (cntl + l);</span><br><span class="line">            <span class="keyword">if</span> (ans1 % <span class="number">2</span> == <span class="number">0</span>) ans1 -= <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> ans2 = r - cntr - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (ans2 % <span class="number">2</span> == <span class="number">0</span>) ans2 -= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">max</span>(ans1, ans2);</span><br><span class="line">        } </span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; q &gt;&gt; ss;</span><br><span class="line">    s = <span class="string">' '</span> + ss;</span><br><span class="line">    <span class="built_in">FOR</span>(i, <span class="number">0</span>, <span class="number">25</span>) {</span><br><span class="line">        tree[i].id = i + <span class="string">'a'</span>;</span><br><span class="line">        tree[i].<span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">FOR</span>(i, <span class="number">1</span>, n) {</span><br><span class="line">        <span class="keyword">if</span> (mp[s[i]] == <span class="number">0</span>) cnt += <span class="number">1</span>;</span><br><span class="line">        mp[s[i]] += <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    Ans = <span class="built_in">solve</span>();</span><br><span class="line">    cout &lt;&lt; Ans &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">    <span class="keyword">while</span> (q--) {</span><br><span class="line">        <span class="type">int</span> x; <span class="type">char</span> c; cin &gt;&gt; x &gt;&gt; c;</span><br><span class="line">        <span class="keyword">if</span> (s[x] == c) { cout &lt;&lt; Ans &lt;&lt; <span class="string">'\n'</span>; <span class="keyword">continue</span>; }</span><br><span class="line">        tree[c - <span class="string">'a'</span>].<span class="built_in">modify</span>(<span class="number">1</span>, <span class="number">1</span>, n, x, <span class="number">0</span>);</span><br><span class="line">        tree[s[x] - <span class="string">'a'</span>].<span class="built_in">modify</span>(<span class="number">1</span>, <span class="number">1</span>, n, x, <span class="number">1</span>);</span><br><span class="line">        mp[s[x]] -= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (mp[s[x]] == <span class="number">0</span>) cnt -= <span class="number">1</span>;</span><br><span class="line">        s[x] = c;</span><br><span class="line">        mp[s[x]] += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (mp[s[x]] == <span class="number">1</span>) cnt += <span class="number">1</span>;</span><br><span class="line">        Ans = <span class="built_in">solve</span>();</span><br><span class="line">        cout &lt;&lt; Ans &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left  disabled "
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/2025/07/16/%E6%9A%91%E8%AE%AD#1%E8%A1%A5%E9%A2%98/"
      title="暑训#1补题.md"
     >

    <p class="title-text">
      
        暑训#1补题.md
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>




  <script src="https://cdn.staticfile.org/twikoo/1.6.26/twikoo.all.min.js"></script>
  <div id="comment-card" class="comment-card">
    <div class="main-title-bar">
      <div class="main-title-dot"></div>
      <div class="main-title">留言 </div>
    </div>
    <div id="tcomment"></div>
  </div>
  <script>
      twikoo.init({
          envId: '',
          el: '#tcomment',
          region: '',
          path: 'location.pathname',
          lang: '',
      })
  </script>
  

    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2025 Istina<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
